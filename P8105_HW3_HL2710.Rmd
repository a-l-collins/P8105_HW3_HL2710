---
title: "P8105_HW3_HL2710"
author: "Ainsel Levitskaia-Collins, HL2710"
date: "2025-10-08"
output: github_document
---

### Preliminary Setup

Adjusting settings such that figures and graphs will be readable:

```{r message = FALSE}
library(tidyverse)

knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

### Problem 1

Loading the dataset that will be used in this problem:

```{r}
library(p8105.datasets)
data("instacart")
```

The `instacart` dataset has `r nrow(instacart)` observations of `r ncol(instacart)` variables. The variables include information such as which user made the order (`user_id`), which items are in the cart (`product_id`), whether these items are being reordered (`reordered`), the name of the product (`product_name`), and other such information. For example, the first item added to user 112108's cart was Bulgarian Yogurt with a product ID of 49302, and this is a reordered item.

#### Determining Aisle Information

First, producing a dataset with number of items ordered per aisle:

```{r}
instacart_aislecounts <- instacart %>% 
  count(aisle, name = "num_items_ordered") %>% 
  arrange(desc(num_items_ordered))
```

Then, selecting the top 5 most popular aisles:

```{r}
instacart_aislecounts %>% slice_head(n = 5)
```

There are `r nrow(instacart_aislecounts)` aisles within the `instacart` dataset, and the top 5 aisles that the most items are ordered from are fresh vegetables, fresh fruits, packaged vegetables and fruits, yogurt, and packaged cheese.

#### Number of Ordered Items per Aisle

Creating a plot that shows the number of items ordered per aisle, limited to only aisles with more than 10,000 items ordered:

```{r}
instacart_aislecounts %>% 
  filter(num_items_ordered > 10000) %>% 
  mutate(aisle = fct_reorder(aisle, desc(num_items_ordered))) %>% 
  ggplot(aes(x = aisle, y = num_items_ordered)) +
  geom_bar(stat = "identity", fill = "chartreuse3", width = .4) +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1)) +
  xlab("") +
  ylab("Number of Items Ordered")
```

#### Table of Most Popular Items

Creating a table of the three most popular items in the aisles “baking ingredients”, “dog food care”, and “packaged vegetables fruits”.

1. Keeping only the desired aisles
1. Counting by `product_name` after grouping by `aisle` and `product_name` so that every product has an associated number of times it was ordered
1. Keeping only the three most popular items per aisle
1. Converting from long to wide format for readability

First, creating a database with information on aisle name, product name, and how many times each item has been ordered:

```{r}
instacart_popular <- instacart %>% 
  filter(aisle == c("baking ingredients", "dog food care", "packaged vegetables fruits")) %>% 
  group_by(aisle) %>% 
  count(product_name, name = "num_items_ordered") %>% 
  arrange(desc(num_items_ordered)) %>% 
  filter(min_rank(desc(num_items_ordered)) < 4)
```

Creating a table to display this information:

```{r}
knitr::kable(
  instacart_popular,
  col.names = c("Aisle", "Product Name", "Number of Items Ordered")
)
```


### Table of Mean hr Day per Week when Pink Lady Apples and Coffee Ice Cream are Ordered

Creating a table in which, for every day of the week, the mean hour of the day at which Pink Lady Apples and Coffee Ice Cream are ordered is displayed.

1. Keeping only the desired products
1. Grouping by day of week
1. Creating a mean time of order variable
1. Using `pivot_wider` to make the data human-readable

I would like to note that while under normal circumstances, I would have renamed the `order_dow` contents from 0-6 to corresponding days of the week, I could not find any confirmation online for whether 0 corresponded to Monday, Sunday, or something else, and have as such chosen to leave `order_dow` in its numerical format.

```{r warning = FALSE, message = FALSE}
instacart_times <- instacart %>% 
  filter(product_name == c("Pink Lady Apples", "Coffee Ice Cream")) %>% 
  group_by(product_name, order_dow) %>% 
  summarize(mean_time = mean(order_hour_of_day, na.rm = TRUE)) %>% 
  pivot_wider(
    names_from = "product_name",
    values_from = "mean_time"
  )
```

Creating a table to display this information:

```{r}
knitr::kable(
  instacart_times,
  col.names = c("Day of Week", "Coffee Ice Cream (military time)", "Pink Lady Apples (military time)"),
  digits = 0
)
```


### Problem 2

Importing and cleaning the Zillow dataset, based on what was done in Homework 2:

Importing and cleaning the `Zip Codes` dataset:

1. Importing and cleaning
1. Moving `zip_code` to the front
1. Remove the `date` variable, as it is not relevant

```{r message = FALSE}
zipcodes <- 
  read_csv("./data/Zip Codes.csv") %>% 
  janitor::clean_names() %>% 
  select(zip_code, everything()) %>% 
  select(-file_date)
```

Importing and cleaning the `zori` dataset:

1. Importing and cleaning
1. Renaming `region_name` to `zip_code` to match the `zipcodes` dataset, and moving that variable to the front
1. Converting the dates and rental prices from wide to long format
1. Adjusting `county_name` to match the corresponding variable in the `zipcodes` dataset

```{r message = FALSE}
zori <-
  read_csv("./data/Zip_zori_uc_sfrcondomfr_sm_month_NYC.csv") %>% 
  janitor::clean_names() %>% 
  select(zip_code = region_name, everything()) %>% 
  separate(county_name, into = c("county", "extra"), sep = " C") %>% 
  select(-extra, -state_name)

zori_neat <-
  pivot_longer(
    zori,
    x2015_01_31:x2024_08_31,
    names_to = "date",
    names_prefix = "x",
    values_to = "rental_price")
```

Merging `zipcodes` and `zori`:

```{r}
zori_zip <- 
  left_join(
    zori_neat, 
    zipcodes, 
    by = c("zip_code", "county")) %>% 
  select(
    zip_code, date, rental_price, county, neighborhood, state, city, metro, 
    everything())
```

